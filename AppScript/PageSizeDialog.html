<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <!-- Select2 JS via jsDelivr -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Select2 CSS via jsDelivr -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- Font Awesome CDN via jsDelivr -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" rel="stylesheet">

    <style>
      html, body {
        overflow-x: hidden !important;
      }
      html.noscroll,
      body.noscroll {
        overflow: hidden !important;
      }
      .initial-spinner-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: #ffffff;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #1a73e8;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .confirm-spinner-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(255, 255, 255, 0.85);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
      html, body {
        margin: 0;
        padding: 0px 10px;
        font-family: "Google Sans", Arial, sans-serif;
        color: #202124;
      }
      @keyframes popIn {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        to {
          opacity: 0;
          transform: scale(0.95);
        }
      }
      .header {
        text-align: left;
        margin-bottom: 10px;
        font-size: 14px;
        line-height: 1.6;
      }
      .header a {
        color: #1a73e8;
        text-decoration: none;
        font-weight: 800;
        display: block;
        margin-bottom: 4px;
      }
      .made-with-love {
        font-weight: bold;
        font-size: 12px;
        color: #5f6368;
        margin-top: 2px;
        margin-bottom: 0px;
      }
      .support-label {
        font-weight: bold;
        font-size: 12px;
        color: #5f6368;
        margin-bottom: -18px;
        display: block;
      }
      .nt-button {
        margin-top: 16px;
        background-color: #1a73e8;
        border: none;
        color: white;
        padding: 8px 12px;
        font-size: 13px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
        width: 100%;
        display: block;
        text-align: center;
        text-decoration: none;
      }
      .nt-button:hover {
        background-color: #1669c1;
      }
      .nt-button:active {
        background-color: #0f5bb5;
      }
      .nt-button-donate {
        margin-top: 0px;
        background-color: #d93025;
        border: none;
        color: white;
        padding: 8px 12px;
        font-size: 13px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
        width: 100%;
        display: block;
        text-align: center;
        text-decoration: none;
      }
      .nt-button-donate:hover {
        background-color: #c5221f;
      }
      .nt-button-donate:active {
        background-color: #a50e0e;
      }
      .nt-button-books {
        margin-bottom: 10px;
        background-color: #146eb4;
        border: none;
        color: white;
        padding: 8px 12px;
        font-size: 13px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
        width: 100%;
        display: block;
        text-align: center;
        text-decoration: none;
      }
      .nt-button-books:hover {
        background-color: #125e9c;
      }
      .nt-button-books:active {
        background-color: #0e4a7a;
      }
      h3 {
        font-size: 20px;
        text-align: center;
        margin-bottom: 6px;
      }
      label {
        display: block;
        margin-top: 10px;
        font-weight: 500;
      }
      input, select {
        width: 100%;
        padding: 8px;
        margin-top: 4px;
        box-sizing: border-box;
        border: 1px solid #dadce0;
        border-radius: 4px;
        font-size: 14px;
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }
      input:focus, select:focus {
        outline: none;
        border: 2px solid #1a73e8;
        box-shadow: 0 0 0 1px #1a73e8;
      }
      button {
        margin-top: 20px;
        background-color: #1a73e8;
        color: white;
        font-weight: bold;
        padding: 10px;
        border: none;
        border-radius: 4px;
        width: 100%;
        cursor: pointer;
      }
      button:hover {
        background-color: #1669c1;
      }
      .footer {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
        color: #5f6368;
      }
      .footer strong {
        color: #d93025;
      }
      #notebottom {
        margin-top: 20px;
        font-size: 12px;
        color: #5f6368;
        line-height: 1.4;
      }
      #notebottom strong {
        font-size: 13px;
        margin-bottom: 6px;
        color: #d93025;
      }
      #notebottom ul {
        padding-left: 20px;
        margin: 0;
      }
      #notebottom li {
        margin-bottom: 6px;
      }
      .preset-row {
        display: flex;
        gap: 12px;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      .preset-wrapper,
      .unit-wrapper {
        flex: 1;
      }
      .preset-wrapper label,
      .unit-wrapper label {
        display: block;
        font-weight: 500;
        margin-bottom: 6px;
      }
      .preset-select,
      .unit-select {
        width: 100%;
        padding: 8px 12px;
        font-size: 14px;
        color: #202124;
        background-color: #fff;
        border: 1px solid #dadce0;
        border-radius: 4px;
        outline: none;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }
      .preset-select:focus,
      .unit-select:focus {
        border-color: #1a73e8;
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.25);
      }
      .dimension-row {
        display: flex;
        gap: 12px;
        justify-content: space-between;
      }
      .dimension-row .width-field,
      .dimension-row .height-field {
        flex: 1;
      }
      .dimension-row label {
        display: block;
      }
      .dimension-row input {
        width: 100%;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #dadce0;
        border-radius: 4px;
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }
      .dimension-row input:focus {
        border: 2px solid #1a73e8;
        box-shadow: 0 0 0 1px #1a73e8;
        outline: none;
      }
      .grid-2x2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      #width:disabled,
      #height:disabled,
      #unit:disabled {
        background-color: #f1f3f4;
        color: #5f6368;
        cursor: not-allowed;
      }
      #snackbar {
        display: none;
        position: fixed;
        bottom: 32px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #d93025;
        color: white;
        padding: 12px 20px;
        border-radius: 4px;
        font-size: 14px;
        z-index: 9999;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        transition: opacity 0.3s ease;
        opacity: 0;
        white-space: nowrap;
        max-width: 90vw;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      /* make the Select2 box fill its container */
      .select2-container {
        width: 100% !important;
      }
      /* match your blue border */
      .select2-container--default .select2-selection--single {
        border: 1px solid #1a73e8;
        border-radius: 4px;
        height: 38px;
        padding: 4px 8px;
      }
      /* focus state */
      .select2-container--default.select2-container--focus
        .select2-selection--single {
        border-color: #1669c1;
        box-shadow: 0 0 0 1px #1669c1;
      }
      /* arrow color */
      .select2-container--default .select2-selection--single .select2-selection__arrow b {
        border-color: transparent transparent #1a73e8 transparent;
      }
      /* dropdown item hover/selected */
      .select2-container--default .select2-results__option--highlighted,
      .select2-container--default .select2-results__option[aria-selected=true] {
        background-color: #1a73e8;
        color: white;
      }
    </style>

    <script>
      window.addEventListener('DOMContentLoaded', () => {
        const spinner = document.getElementById('initial-spinner');
        const body = document.body;

        setTimeout(() => {
          spinner.style.display = 'none';
          body.style.animation = 'popIn 0.3s ease-out';
        }, 200);

        // Initialize Select2 on the preset and unit dropdowns
        $('#preset').select2({
          dropdownParent: $('#mainBody'),
          allowClear: false,
        });
        $('#unit').select2({
          dropdownParent: $('#mainBody'),
          allowClear: false
        });
      });
    </script>
  </head>

  <body id="mainBody">
    <div id="initial-spinner" class="initial-spinner-overlay">
      <div class="spinner"></div>
    </div>

    <div class="header">
      <label class="support-label">Support Adam Natad</label>
      <button
          class="nt-button-books"
          onclick="window.open('https://www.amazon.com/author/adam-natad','_blank')"
          style="display:inline-flex; align-items:center; justify-content:center; gap:8px;"
      >
          <i class="fab fa-amazon" style="font-size:18px;"></i>
          Books by Adam Natad
      </button>
      <div class="made-with-love">Made with ♥️</div>
      <button
        class="nt-button-donate"
        onclick="window.open('https://youtube.com/@AdamNatad','_blank')"
        style="display:inline-flex; align-items:center; justify-content:center; gap:8px;"
      >
        <i class="fab fa-youtube" style="font-size:20px; flex-shrink:0;"></i>
        Subscribe to Adam Natad on YouTube
      </button>
    </div>

    <div class="preset-row">
      <div class="preset-wrapper">
        <label for="preset">Trim Size - Presets:</label>
        <select id="preset" class="preset-select" onchange="applyPreset()">
          
          <option value="custom">Custom Size</option>
          <option value="8.5x11">Google Default</option>
          <option value="5x8">5 x 8 in</option>
          <option value="5.25x8">5.25 x 8 in</option>
          <option value="5.5x8.5">5.5 x 8.5 in</option>
          <option value="6x9">6 x 9 in</option>
          <option value="5.06x7.81">5.06 x 7.81 in</option>
          <option value="6.14x9.21">6.14 x 9.21 in</option>
          <option value="6.69x9.61">6.69 x 9.61 in</option>
          <option value="7x10">7 x 10 in</option>
          <option value="7.44x9.69">7.44 x 9.69 in</option>
          <option value="7.5x9.25">7.5 x 9.25 in</option>
          <option value="8x10">8 x 10 in</option>
          <option value="8.27x11.69">8.27 x 11.69 in</option>
          <option value="8.25x6">8.25 x 6 in</option>
          <option value="8.25x8.25">8.25 x 8.25 in</option>
          <option value="8.25x11">8.25 x 11 in</option>
          <option value="8.5x8.5">8.5 x 8.5 in</option>
          <option value="8.5x11">8.5 x 11 in</option>
        </select>
      </div>

      <div class="unit-wrapper">
        <label for="unit">Unit:</label>
        <select id="unit" class="unit-select">
          <option value="in">Inches</option>
          <option value="cm">Centimeters</option>
        </select>
      </div>
    </div>

    <div class="dimension-row">
      <label class="width-field">
        Width:
        <input type="number" step="0.01" id="width" required>
      </label>
      <label class="height-field">
        Height:
        <input type="number" step="0.01" id="height" required>
      </label>
    </div>

    <hr />

    <div class="grid-2x2">
      <label>Top Margin:
        <input type="number" step="0.01" id="marginTop" value="1.0" required>
      </label>
      <label>Bottom Margin:
        <input type="number" step="0.01" id="marginBottom" value="1.0" required>
      </label>
      <label>Left Margin:
        <input type="number" step="0.01" id="marginLeft" value="1.0" required>
      </label>
      <label>Right Margin:
        <input type="number" step="0.01" id="marginRight" value="1.0" required>
      </label>
    </div>

    <button type="button" onclick="submitForm()">
      Apply Page Settings
    </button>
    <div id="snackbar"></div>

    <div id="notebottom">
      <p>
        <strong>EXPORT OR DOWNLOAD NOTE:</strong> Do not export or download
        directly to PDF from Google Docs as this may cause incorrect page
        dimensions. Instead, export your document as a <strong>.docx</strong>
        file by selecting <em>File → Download → Microsoft Word (.docx)</em>.
        Open the file in MS Word, verify the page size via <em>Layout →
        Size → More Paper Sizes…</em>, and then convert it to PDF.
      </p>
      <p>
        <strong>WARNING:</strong> setting a custom page size that is not
        officially supported by Google Docs, the default <i>File →
        Page Setup</i> may become unusable. To restore access, use this add-on
        to switch back to a Google-supported paper size <strong>(Google Default - Preset)</strong>.
      </p>
    </div>

    <div id="confirm-spinner" class="confirm-spinner-overlay" style="display: none;">
      <div class="spinner"></div>
    </div>

    <script>
      const presets = {
        "5x8": { width: 5.0, height: 8.0 },
        "5.25x8": { width: 5.25, height: 8.0 },
        "5.5x8.5": { width: 5.5, height: 8.5 },
        "6x9": { width: 6.0, height: 9.0 },
        "5.06x7.81": { width: 5.06, height: 7.81 },
        "6.14x9.21": { width: 6.14, height: 9.21 },
        "6.69x9.61": { width: 6.69, height: 9.61 },
        "7x10": { width: 7.0, height: 10.0 },
        "7.44x9.69": { width: 7.44, height: 9.69 },
        "7.5x9.25": { width: 7.5, height: 9.25 },
        "8x10": { width: 8.0, height: 10.0 },
        "8.27x11.69": { width: 8.27, height: 11.69 },
        "8.25x6": { width: 8.25, height: 6.0 },
        "8.25x8.25": { width: 8.25, height: 8.25 },
        "8.25x11": { width: 8.25, height: 11.0 },
        "8.5x8.5": { width: 8.5, height: 8.5 },
        "8.5x11": { width: 8.5, height: 11.0 }
      };

      function applyPreset() {
        const preset = document.getElementById("preset").value;
        const widthInput = document.getElementById("width");
        const heightInput = document.getElementById("height");
        const unitSelect = document.getElementById("unit");

        if (presets[preset]) {
          widthInput.value = presets[preset].width;
          heightInput.value = presets[preset].height;
          unitSelect.value = "in";

          // Disable inputs
          widthInput.disabled = true;
          heightInput.disabled = true;
          unitSelect.disabled = true;
        } else {
          // Re-enable inputs for custom/manual sizes
          widthInput.disabled = false;
          heightInput.disabled = false;
          unitSelect.disabled = false;
        }
      }

      function showSnackbar(message) {
        const bar = document.getElementById("snackbar");
        bar.textContent = message;
        bar.style.display = "block";
        bar.style.opacity = "1";

        setTimeout(() => {
          bar.style.opacity = "0";
          setTimeout(() => {
            bar.style.display = "none";
          }, 300);
        }, 3000);
      }

      function submitForm() {
        const width = parseFloat(document.getElementById("width").value);
        const height = parseFloat(document.getElementById("height").value);
        const unit = document.getElementById("unit").value;
        const marginTop = parseFloat(document.getElementById("marginTop").value);
        const marginBottom = parseFloat(document.getElementById("marginBottom").value);
        const marginLeft = parseFloat(document.getElementById("marginLeft").value);
        const marginRight = parseFloat(document.getElementById("marginRight").value);

        if (
          isNaN(width) ||
          isNaN(height) ||
          !unit ||
          isNaN(marginTop) ||
          isNaN(marginBottom) ||
          isNaN(marginLeft) ||
          isNaN(marginRight)
        ) {
          showSnackbar("⚠️ Please enter valid values in all fields.");
          return;
        }

        const data = {
          width,
          height,
          unit,
          marginTop,
          marginBottom,
          marginLeft,
          marginRight
        };

        // hide scrollbars immediately
        document.documentElement.classList.add('noscroll');
        document.body.classList.add('noscroll');
        
        const mainBody = document.getElementById("mainBody");
        const confirmSpinner = document.getElementById("confirm-spinner");

        requestAnimationFrame(() => {
          confirmSpinner.style.display = "flex";

          google.script.run
            .withSuccessHandler(() => {
              setTimeout(() => {
                confirmSpinner.style.display = "none";
                google.script.run.showSuccessDialog();
                google.script.host.close();
              }, 300);
            })
            .setCustomPageSizeAndMargins(data);
        });
      }
    </script>
  </body>
</html>
